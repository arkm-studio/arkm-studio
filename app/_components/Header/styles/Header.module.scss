@import "./variables";
@import "./mixins";
@import "@/app/_styles/mixins";

.header {
  $self: &;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: $header-z-index;
  height: var(--header-height, #{$header-height});
  padding: var(--header-padding-desktop, #{$header-padding});
  transition: all $transition-duration $transition-bezier;

  // Variants
  &--solid {
    background: $header-background;
  }

  &--transparent {
    background: transparent;

    &#{$self}--scrolled {
      background: rgba($header-background, 0.8);
    }
  }

  &--glass {
    background: transparent;
  }

  &--blur {
    background: transparent;

    // &#{$self}--scrolled {
    //   &::before {
    //     content: "";
    //     position: absolute;
    //     top: 0;
    //     left: 0;
    //     right: 0;
    //     height: 100%;
    //     background: linear-gradient(
    //       to bottom,
    //       rgba(darken($header-background, 10%), 0.95) 0%,
    //       rgba($header-background, 0.75) 40%,
    //       rgba($header-background, 0.3) 80%,
    //       transparent 100%
    //     );
    //     backdrop-filter: blur(10px);
    //     -webkit-backdrop-filter: blur(10px);
    //     z-index: -1;
    //   }
    // }

    &#{$self}--scrolled {
      overflow: hidden;

      // Técnica de capas apiladas para blur progresivo
      $layers: 12;
      @for $i from 1 through $layers {
        $blur-strength: 14px - (($i - 1) * (10px / $layers));
        $opacity: 0.9 - (($i - 1) * (0.7 / $layers));
        $height: 100% - (($i - 1) * (60% / $layers));

        &::after {
          content: "";
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          height: $height;
          background: rgba(darken($header-background, 5%), $opacity);
          backdrop-filter: blur($blur-strength);
          -webkit-backdrop-filter: blur($blur-strength);
          z-index: -#{$i};
          transform: translateZ(0); /* forzar aceleración hardware */
          clip-path: polygon(
            0 0,
            100% 0,
            100% calc(100% - #{10px + $i * 2px}),
            0 100%
          );
        }
      }

      // @for $i from 1 through $layers {
      //   // Cálculo para que llegue a 0 en la última capa
      //   $blur-strength: 14px - (($i - 1) * (14px / ($layers - 1)));
      //   $opacity: if(
      //     $i == $layers,
      //     0,
      //     0.9 - (($i - 1) * (0.9 / ($layers - 1)))
      //   );
      //   $height: 100% - (($i - 1) * (60% / ($layers - 1)));

      //   &::after {
      //     content: "";
      //     position: absolute;
      //     top: 0;
      //     left: 0;
      //     right: 0;
      //     height: $height;
      //     background: rgba(darken($header-background, 5%), $opacity);
      //     backdrop-filter: blur($blur-strength);
      //     -webkit-backdrop-filter: blur($blur-strength);
      //     z-index: -#{$i};
      //     transform: translateZ(0); /* forzar aceleración hardware */
      //     clip-path: polygon(
      //       0 0,
      //       100% 0,
      //       100% calc(100% - #{10px + $i * 2px}),
      //       0 100%
      //     );
      //   }
      // }

      &::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 100%;
        background: linear-gradient(
          to bottom,
          rgba(darken($header-background, 10%), 0.9) 0%,
          rgba($header-background, 0.7) 40%,
          rgba($header-background, 0.3) 80%,
          transparent 100%
        );
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        z-index: -1;
      }
    }
  }

  &__content {
    width: 100%;
    max-width: $content-max-width;
    margin: 0 auto;
    height: 100%;
  }

  &__nav {
    display: flex;
    height: 100%;
    align-items: center;

    &-wrapper {
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: $spacing-md;
    }
  }

  &__menu-group {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  &__menu-trigger {
    position: relative;
    z-index: calc($z-index-modal + 1);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  &__language-selector {
    transform: translateY(-2.5px);
  }

  &__divider {
    position: relative;
    width: 1.5px;
    height: 16px;
    background: rgba($primary-color, 0.2);
    transform: translateX(-1px);

    &--mobile {
      @media (min-width: $mobile-breakpoint) {
        display: none;
      }
    }
  }

  &__portal-button {
    padding: 0.675rem 1.325rem !important;

    span {
      font-weight: 600 !important;
      font-family: "usual", sans-serif !important;
      letter-spacing: 0.05em !important;
      font-size: 12px !important;
    }
  }

  &__logo {
    @include flex(
      $direction: column,
      $align: center,
      $justify: center,
      $gap: 2px
    );

    position: absolute;
    right: 50%;
    transform: translateX(50%);

    &-subtitle {
      letter-spacing: 0.046em !important;
    }

    &-subtitle-first-letter {
      font-size: 11px;
    }
  }

  &__actions-group {
    display: flex;
    align-items: center;

    @media (max-width: $mobile-breakpoint) {
      .header__portal-button,
      .header__divider,
      .header__language-selector {
        // Adjust class name based on your LanguageSelector component
        display: none;
      }
    }
  }
}
